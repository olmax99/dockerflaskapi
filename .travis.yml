dist:  xenial
language:  python
python:  3.7.2

services:
  - docker

branches:
  only:
  - master
  - /^ci-.*$/

env:
  - APP_DIR="$TRAVIS_BUILD_DIR/webflaskapi"

before_install:
  - echo -e "Default Environment Variables:\n------------------------\n
    TRAVIS_BUILD_DIR='$TRAVIS_BUILD_DIR'\n\n
    Custom Environment Variables\n------------------------\n
    APP_DIR='$APP_DIR'"
  - ls -al $TRAVIS_BUILD_DIR
  - ls -al $APP_DIR

install:
  - cd $APP_DIR && pipenv lock && cd $TRAVIS_BUILD_DIR

script:
  - docker-compose -f docker-compose.testing.yml up -d --build
  - docker ps -a
  - docker-compose -f docker-compose.testing.yml exec web.testing sh -c 'pytest -v --disable-warnings'
  - docker-compose -f docker-compose.testing.yml exec worker.testing sh -c 'pytest -v --disable-warnings'
